//@version=6
strategy("SmaCross Strategy - é›™å‡ç·šäº¤å‰ç­–ç•¥", 
         overlay=true, 
         initial_capital=100000,
         default_qty_type=strategy.percent_of_equity,
         default_qty_value=100,
         commission_type=strategy.commission.percent,
         commission_value=0.1,
         process_orders_on_close=false,
         calc_on_every_tick=false)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ç­–ç•¥åç¨±ï¼šé›™å‡ç·šäº¤å‰ç­–ç•¥ (Simple Moving Average Crossover)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 
// ã€é‡è¦è¨­å®šèªªæ˜ã€‘
// - process_orders_on_close=false: è¨‚å–®åœ¨ä¸‹ä¸€æ ¹ K æ£’é–‹ç›¤æ™‚åŸ·è¡Œ
// - calc_on_every_tick=false: åªåœ¨ K æ£’æ”¶ç›¤æ™‚è¨ˆç®—ï¼ˆé¿å…é‡ç¹ªï¼‰
// 
// é€™æ¨£çš„è¨­å®šèˆ‡ Python backtesting.py çš„é‚è¼¯ä¸€è‡´ï¼š
// 1. ç•¶å‰ K æ£’æ”¶ç›¤æ™‚æª¢æ¸¬åˆ°è¨Šè™Ÿ
// 2. ä¸‹ä¸€æ ¹ K æ£’é–‹ç›¤æ™‚åŸ·è¡Œäº¤æ˜“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ========== ç­–ç•¥åƒæ•¸è¨­å®š ==========
n1 = input.int(10, "çŸ­æœŸå‡ç·šé€±æœŸ (SMA Short)", minval=1, maxval=200, 
               tooltip="çŸ­æœŸç§»å‹•å¹³å‡ç·šçš„è¨ˆç®—é€±æœŸï¼Œé è¨­ç‚º 10 æ ¹ K æ£’")
n2 = input.int(50, "é•·æœŸå‡ç·šé€±æœŸ (SMA Long)", minval=1, maxval=500, 
               tooltip="é•·æœŸç§»å‹•å¹³å‡ç·šçš„è¨ˆç®—é€±æœŸï¼Œé è¨­ç‚º 50 æ ¹ K æ£’")

// ========== è¨ˆç®—æŠ€è¡“æŒ‡æ¨™ ==========
// è¨ˆç®—çŸ­æœŸç°¡å–®ç§»å‹•å¹³å‡ç·š (SMA)
sma_short = ta.sma(close, n1)

// è¨ˆç®—é•·æœŸç°¡å–®ç§»å‹•å¹³å‡ç·š (SMA)
sma_long = ta.sma(close, n2)

// ========== ç¹ªè£½æŒ‡æ¨™åˆ°åœ–è¡¨ ==========
// åœ¨ä¸»åœ–ä¸Šç¹ªè£½çŸ­æœŸå‡ç·šï¼ˆè—è‰²ï¼‰
plot(sma_short, title="SMA Short", color=color.blue, linewidth=2)

// åœ¨ä¸»åœ–ä¸Šç¹ªè£½é•·æœŸå‡ç·šï¼ˆæ©˜è‰²ï¼‰
plot(sma_long, title="SMA Long", color=color.orange, linewidth=2)

// ========== äº¤æ˜“è¨Šè™Ÿæª¢æ¸¬ ==========
// ta.crossover(source1, source2) æª¢æ¸¬ source1 æ˜¯å¦ç”±ä¸‹å¾€ä¸Šç©¿è¶Š source2
// é»ƒé‡‘äº¤å‰ï¼šçŸ­æœŸå‡ç·šå‘ä¸Šç©¿è¶Šé•·æœŸå‡ç·š
golden_cross = ta.crossover(sma_short, sma_long)

// æ­»äº¡äº¤å‰ï¼šçŸ­æœŸå‡ç·šå‘ä¸‹è·Œç ´é•·æœŸå‡ç·š
death_cross = ta.crossover(sma_long, sma_short)

// ========== åŸ·è¡Œäº¤æ˜“é‚è¼¯ ==========
// â˜… é»ƒé‡‘äº¤å‰ â†’ è²·å…¥è¨Šè™Ÿ â˜…
if golden_cross
    strategy.entry("Long", strategy.long, comment="ğŸŸ¢ é»ƒé‡‘äº¤å‰è²·å…¥")

// â˜… æ­»äº¡äº¤å‰ â†’ è³£å‡ºè¨Šè™Ÿ â˜…
if death_cross
    strategy.close("Long", comment="ğŸ”´ æ­»äº¡äº¤å‰è³£å‡º")

// ========== è¦–è¦ºåŒ–äº¤æ˜“è¨Šè™Ÿ ==========
// åœ¨åœ–è¡¨ä¸Šæ¨™è¨˜é»ƒé‡‘äº¤å‰é»ï¼ˆç¶ è‰²å‘ä¸Šä¸‰è§’å½¢ï¼‰
plotshape(golden_cross, 
          title="é»ƒé‡‘äº¤å‰", 
          location=location.belowbar, 
          color=color.new(color.green, 0), 
          style=shape.triangleup, 
          size=size.small,
          text="è²·å…¥")

// åœ¨åœ–è¡¨ä¸Šæ¨™è¨˜æ­»äº¡äº¤å‰é»ï¼ˆç´…è‰²å‘ä¸‹ä¸‰è§’å½¢ï¼‰
plotshape(death_cross, 
          title="æ­»äº¡äº¤å‰", 
          location=location.abovebar, 
          color=color.new(color.red, 0), 
          style=shape.triangledown, 
          size=size.small,
          text="è³£å‡º")

// ========== èƒŒæ™¯é¡è‰²æç¤º ==========
// ç•¶æŒæœ‰å¤šé ­å€‰ä½æ™‚ï¼ŒèƒŒæ™¯é¡¯ç¤ºæ·¡ç¶ è‰²
bgcolor(strategy.position_size > 0 ? color.new(color.green, 90) : na, 
        title="æŒå€‰èƒŒæ™¯")

// ========== è­¦å ±æ¢ä»¶è¨­å®š ==========
alertcondition(golden_cross, 
               title="é»ƒé‡‘äº¤å‰è­¦å ±", 
               message="SmaCross ç­–ç•¥ï¼šæª¢æ¸¬åˆ°é»ƒé‡‘äº¤å‰ï¼Œå»ºè­°è²·å…¥ï¼")

alertcondition(death_cross, 
               title="æ­»äº¡äº¤å‰è­¦å ±", 
               message="SmaCross ç­–ç•¥ï¼šæª¢æ¸¬åˆ°æ­»äº¡äº¤å‰ï¼Œå»ºè­°è³£å‡ºï¼")
