# 策略文件 (Strategy Documentation)

本文件詳細說明回測系統中所有可用策略的運作原理、優缺點及參數設定。

---

## 目錄

1. [SMA Cross (雙均線交叉)](#1-sma-cross-雙均線交叉)
2. [RSI Mean Reversion (RSI 均值回歸)](#2-rsi-mean-reversion-rsi-均值回歸)
3. [SMA Cross + ATR 停損](#3-sma-cross--atr-停損)
4. [LuciTech EMA (風險管理)](#4-lucitech-ema-風險管理)

---

## 1. SMA Cross (雙均線交叉)

### 策略原理

利用短期均線和長期均線的交叉來判斷趨勢變化。當短期均線穿越長期均線時，視為趨勢反轉訊號。

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 黃金交叉 | 短均線向上穿越長均線 | 買入 |
| 死亡交叉 | 短均線向下跌破長均線 | 平倉 |

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `n1` | 短期均線週期 | 10 | 5-30 |
| `n2` | 長期均線週期 | 50 | 20-200 |

### 優點

- ✅ 邏輯簡單，容易理解
- ✅ 能捕捉中長期趨勢
- ✅ 適合趨勢明顯的市場

### 缺點

- ❌ 在震盪市場容易產生假訊號
- ❌ 訊號有延遲，可能錯過最佳進場點
- ❌ 頻繁交叉會增加交易成本

### 適用場景

- 趨勢明顯的單邊行情
- 中長線持倉

---

## 2. RSI Mean Reversion (RSI 均值回歸)

### 策略原理

RSI (Relative Strength Index) 是衡量價格超買超賣的震盪指標。基於「均值回歸」理論：價格偏離常態後會回歸平均。

### RSI 計算方式

```
RS = 平均漲幅 / 平均跌幅
RSI = 100 - (100 / (1 + RS))
```

### 交易訊號

| 訊號 | 條件 | 意義 |
|------|------|------|
| 超賣 | RSI < 下限閾值 | 市場過度悲觀，預期反彈 |
| 超買 | RSI > 上限閾值 | 市場過度樂觀，預期回落 |

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `rsi_period` | RSI 計算週期 | 14 | 7-21 |
| `upper_bound` | 超買閾值 | 70 | 65-80 |
| `lower_bound` | 超賣閾值 | 30 | 20-35 |

### 優點

- ✅ 能捕捉短期價格反轉機會
- ✅ 在震盪市場表現較好
- ✅ 提供明確的超買超賣訊號

### 缺點

- ❌ 在強勢趨勢中容易過早平倉
- ❌ RSI 可能長時間停留在極端區域
- ❌ 需要搭配其他指標確認訊號

### 適用場景

- 區間震盪行情
- 短線交易

---

## 3. SMA Cross + ATR 停損

### 策略原理

在傳統雙均線交叉策略的基礎上，加入 ATR 動態停損機制，讓停損點能根據市場波動度自動調整。

### ATR 計算方式

```
True Range = max(High-Low, |High-前Close|, |Low-前Close|)
ATR = True Range 的 N 日平均值
```

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 買入 | 短均線向上穿越長均線 | 買入 + 設定 SL/TP |
| 平倉 | 觸及 SL/TP 或死亡交叉 | 平倉 |

### 停損/停利計算

- **停損** = 進場價 - ATR × 停損倍數
- **停利** = 進場價 + ATR × 停利倍數

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `n1` | 短期均線週期 | 10 | 5-30 |
| `n2` | 長期均線週期 | 50 | 20-200 |
| `atr_period` | ATR 計算週期 | 14 | 10-20 |
| `sl_multiplier` | 停損 ATR 倍數 | 2.0 | 1.0-3.0 |
| `tp_multiplier` | 停利 ATR 倍數 | 3.0 | 2.0-5.0 |

### 優點

- ✅ 停損距離會根據市場波動自動調整
- ✅ 在高波動市場不容易被假突破掃出
- ✅ 在低波動市場能更好保護利潤
- ✅ 風險報酬比可預先設定

### 缺點

- ❌ ATR 參數需要根據不同市場調整
- ❌ 極端行情下可能無法完全保護

### 適用場景

- 需要嚴格風險控制的交易
- 波動性變化較大的市場

---

## 4. LuciTech EMA (風險管理)

### 策略來源

根據 TradingView 上 LuciTech 分享的 Pine Script 策略模板轉換。

### 策略原理

結合 EMA 穿越訊號和完整的風險管理系統：
- **進場**：價格穿越 EMA 均線
- **停損**：ATR-based 動態停損或 Candle-based 結構停損
- **停利**：基於風險報酬比 (Risk:Reward Ratio)

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 買入 | 收盤價向上穿越 EMA | 買入 + 設定 SL/TP |
| 平倉 | 收盤價跌破 EMA 或觸及 SL/TP | 平倉 |

### 停損計算

**ATR 模式**：
- 停損 = Low - ATR × ATR倍數

**Candle 模式**：
- 停損 = 前 N 根 K 棒的最低點

### 停利計算

```
停損距離 = 進場價 - 停損價
停利 = 進場價 + 停損距離 × 風險報酬比
```

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `ema_period` | EMA 均線週期 | 15 | 10-30 |
| `atr_period` | ATR 計算週期 | 14 | 10-20 |
| `atr_multiplier` | ATR 停損倍數 | 1.5 | 1.0-3.0 |
| `risk_reward` | 風險報酬比 | 2.0 | 1.5-4.0 |
| `sl_candle_lookback` | Candle 停損回看 K 棒數 | 1 | 0-5 |
| `use_atr_sl` | 使用 ATR 停損 | True | True/False |

### 優點

- ✅ EMA 比 SMA 更靈敏，反應更快
- ✅ ATR 動態停損適應市場波動
- ✅ 固定風險報酬比確保正期望值
- ✅ 可選擇 ATR 或 Candle 停損方式

### 缺點

- ❌ 參數較多，需要調優
- ❌ 單一 EMA 在震盪市可能產生假訊號

### 適用場景

- 趨勢跟隨交易
- 需要明確風險報酬設定的交易系統

---

## 5. LuciTech EMA Short (雙向交易)

### 策略原理

與 LuciTech EMA 相同，但支持**雙向交易**（做多 + 做空）。當價格向下跌破 EMA 時會開空單。

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 買入 | 收盤價向上穿越 EMA | 做多 + 設定 SL/TP |
| 賣空 | 收盤價向下跌破 EMA | 做空 + 設定 SL/TP |
| 平多 | 收盤價跌破 EMA 或觸及 SL/TP | 平多倉 |
| 平空 | 收盤價突破 EMA 或觸及 SL/TP | 平空倉 |

### 做空時的 SL/TP 計算

**ATR 模式**：
- 停損 = High + ATR × ATR倍數
- 停損距離 = 停損 - 進場價
- 停利 = 進場價 - 停損距離 × 風險報酬比

**Candle 模式**：
- 停損 = 前 N 根 K 棒的最高點

### 參數說明

與 LuciTech EMA 相同：

| 參數 | 說明 | 預設值 |
|------|------|--------|
| `ema_period` | EMA 均線週期 | 15 |
| `atr_period` | ATR 計算週期 | 14 |
| `atr_multiplier` | ATR 停損倍數 | 1.5 |
| `risk_reward` | 風險報酬比 | 2.0 |
| `sl_candle_lookback` | Candle 停損回看 K 棒數 | 1 |
| `use_atr_sl` | 使用 ATR 停損 | True |

### 優點

- ✅ 可做多也可做空，雙向獲利機會
- ✅ 下跌趨勢中也能獲利
- ✅ 與 LuciTech EMA 相同的風險管理邏輯

### 缺點

- ❌ 做空風險理論上無限（價格可無限上漲）
- ❌ 震盪市場可能頻繁反向開倉
- ❌ 需要支持做空的交易所/平台

### 適用場景

- 合約交易（支持做空）
- 雙向趨勢跟隨策略

> ⚠️ **注意**：此策略目前未加入 UI 介面，需手動在程式碼中使用。

---

## 策略選擇建議

| 市場狀態 | 推薦策略 |
|----------|----------|
| 強勢趨勢 | SMA Cross, LuciTech EMA |
| 區間震盪 | RSI Mean Reversion |
| 高波動 | SMA Cross + ATR 停損, LuciTech EMA |
| 低波動 | RSI Mean Reversion |

---

## 參數優化建議

1. **避免過度擬合**：使用不同時間段的數據進行樣本外測試
2. **考慮交易成本**：過短的週期參數會增加交易頻率
3. **風險報酬比**：建議至少 1.5:1 以上
4. **停損設定**：ATR 倍數建議 1.5-2.5 之間
