# 策略文件 (Strategy Documentation)

本文件詳細說明回測系統中所有可用策略的運作原理、優缺點及參數設定。

---

## 目錄

1. [SMA Cross (雙均線交叉)](#1-sma-cross-雙均線交叉)
2. [RSI Mean Reversion (RSI 均值回歸)](#2-rsi-mean-reversion-rsi-均值回歸)
3. [SMA Cross + ATR 停損](#3-sma-cross--atr-停損)
4. [LuciTech EMA (風險管理)](#4-lucitech-ema-風險管理)
5. [LuciTech EMA Short (雙向交易)](#5-lucitech-ema-short-雙向交易)
6. [FreedX Grid Backtest (網格交易回測)](#6-freedx-grid-backtest-網格交易回測)
7. [Ehlers Combo (綜合策略)](#7-ehlers-combo-綜合策略)

---

## 1. SMA Cross (雙均線交叉)

### 策略原理

利用短期均線和長期均線的交叉來判斷趨勢變化。當短期均線穿越長期均線時，視為趨勢反轉訊號。

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 黃金交叉 | 短均線向上穿越長均線 | 買入 |
| 死亡交叉 | 短均線向下跌破長均線 | 平倉 |

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `n1` | 短期均線週期 | 10 | 5-30 |
| `n2` | 長期均線週期 | 50 | 20-200 |

### 優點

- ✅ 邏輯簡單，容易理解
- ✅ 能捕捉中長期趨勢
- ✅ 適合趨勢明顯的市場

### 缺點

- ❌ 在震盪市場容易產生假訊號
- ❌ 訊號有延遲，可能錯過最佳進場點
- ❌ 頻繁交叉會增加交易成本

### 適用場景

- 趨勢明顯的單邊行情
- 中長線持倉

---

## 2. RSI Mean Reversion (RSI 均值回歸)

### 策略原理

RSI (Relative Strength Index) 是衡量價格超買超賣的震盪指標。基於「均值回歸」理論：價格偏離常態後會回歸平均。

### RSI 計算方式

```
RS = 平均漲幅 / 平均跌幅
RSI = 100 - (100 / (1 + RS))
```

### 交易訊號

| 訊號 | 條件 | 意義 |
|------|------|------|
| 超賣 | RSI < 下限閾值 | 市場過度悲觀，預期反彈 |
| 超買 | RSI > 上限閾值 | 市場過度樂觀，預期回落 |

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `rsi_period` | RSI 計算週期 | 14 | 7-21 |
| `upper_bound` | 超買閾值 | 70 | 65-80 |
| `lower_bound` | 超賣閾值 | 30 | 20-35 |

### 優點

- ✅ 能捕捉短期價格反轉機會
- ✅ 在震盪市場表現較好
- ✅ 提供明確的超買超賣訊號

### 缺點

- ❌ 在強勢趨勢中容易過早平倉
- ❌ RSI 可能長時間停留在極端區域
- ❌ 需要搭配其他指標確認訊號

### 適用場景

- 區間震盪行情
- 短線交易

---

## 3. SMA Cross + ATR 停損

### 策略原理

在傳統雙均線交叉策略的基礎上，加入 ATR 動態停損機制，讓停損點能根據市場波動度自動調整。

### ATR 計算方式

```
True Range = max(High-Low, |High-前Close|, |Low-前Close|)
ATR = True Range 的 N 日平均值
```

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 買入 | 短均線向上穿越長均線 | 買入 + 設定 SL/TP |
| 平倉 | 觸及 SL/TP 或死亡交叉 | 平倉 |

### 停損/停利計算

- **停損** = 進場價 - ATR × 停損倍數
- **停利** = 進場價 + ATR × 停利倍數

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `n1` | 短期均線週期 | 10 | 5-30 |
| `n2` | 長期均線週期 | 50 | 20-200 |
| `atr_period` | ATR 計算週期 | 14 | 10-20 |
| `sl_multiplier` | 停損 ATR 倍數 | 2.0 | 1.0-3.0 |
| `tp_multiplier` | 停利 ATR 倍數 | 3.0 | 2.0-5.0 |

### 優點

- ✅ 停損距離會根據市場波動自動調整
- ✅ 在高波動市場不容易被假突破掃出
- ✅ 在低波動市場能更好保護利潤
- ✅ 風險報酬比可預先設定

### 缺點

- ❌ ATR 參數需要根據不同市場調整
- ❌ 極端行情下可能無法完全保護

### 適用場景

- 需要嚴格風險控制的交易
- 波動性變化較大的市場

---

## 4. LuciTech EMA (風險管理)

### 策略來源

根據 TradingView 上 LuciTech 分享的 Pine Script 策略模板轉換。

### 策略原理

結合 EMA 穿越訊號和完整的風險管理系統：
- **進場**：價格穿越 EMA 均線
- **停損**：ATR-based 動態停損或 Candle-based 結構停損
- **停利**：基於風險報酬比 (Risk:Reward Ratio)

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 買入 | 收盤價向上穿越 EMA | 買入 + 設定 SL/TP |
| 平倉 | 收盤價跌破 EMA 或觸及 SL/TP | 平倉 |

### 停損計算

**ATR 模式**：
- 停損 = Low - ATR × ATR倍數

**Candle 模式**：
- 停損 = 前 N 根 K 棒的最低點

### 停利計算

```
停損距離 = 進場價 - 停損價
停利 = 進場價 + 停損距離 × 風險報酬比
```

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `ema_period` | EMA 均線週期 | 15 | 10-30 |
| `atr_period` | ATR 計算週期 | 14 | 10-20 |
| `atr_multiplier` | ATR 停損倍數 | 1.5 | 1.0-3.0 |
| `risk_reward` | 風險報酬比 | 2.0 | 1.5-4.0 |
| `sl_candle_lookback` | Candle 停損回看 K 棒數 | 1 | 0-5 |
| `use_atr_sl` | 使用 ATR 停損 | True | True/False |

### 優點

- ✅ EMA 比 SMA 更靈敏，反應更快
- ✅ ATR 動態停損適應市場波動
- ✅ 固定風險報酬比確保正期望值
- ✅ 可選擇 ATR 或 Candle 停損方式

### 缺點

- ❌ 參數較多，需要調優
- ❌ 單一 EMA 在震盪市可能產生假訊號

### 適用場景

- 趨勢跟隨交易
- 需要明確風險報酬設定的交易系統

---

## 5. LuciTech EMA Short (雙向交易)

### 策略原理

與 LuciTech EMA 相同，但支持**雙向交易**（做多 + 做空）。當價格向下跌破 EMA 時會開空單。

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 買入 | 收盤價向上穿越 EMA | 做多 + 設定 SL/TP |
| 賣空 | 收盤價向下跌破 EMA | 做空 + 設定 SL/TP |
| 平多 | 收盤價跌破 EMA 或觸及 SL/TP | 平多倉 |
| 平空 | 收盤價突破 EMA 或觸及 SL/TP | 平空倉 |

### 做空時的 SL/TP 計算

**ATR 模式**：
- 停損 = High + ATR × ATR倍數
- 停損距離 = 停損 - 進場價
- 停利 = 進場價 - 停損距離 × 風險報酬比

**Candle 模式**：
- 停損 = 前 N 根 K 棒的最高點

### 參數說明

與 LuciTech EMA 相同：

| 參數 | 說明 | 預設值 |
|------|------|--------|
| `ema_period` | EMA 均線週期 | 15 |
| `atr_period` | ATR 計算週期 | 14 |
| `atr_multiplier` | ATR 停損倍數 | 1.5 |
| `risk_reward` | 風險報酬比 | 2.0 |
| `sl_candle_lookback` | Candle 停損回看 K 棒數 | 1 |
| `use_atr_sl` | 使用 ATR 停損 | True |

### 優點

- ✅ 可做多也可做空，雙向獲利機會
- ✅ 下跌趨勢中也能獲利
- ✅ 與 LuciTech EMA 相同的風險管理邏輯

### 缺點

- ❌ 做空風險理論上無限（價格可無限上漲）
- ❌ 震盪市場可能頻繁反向開倉
- ❌ 需要支持做空的交易所/平台

### 適用場景

- 合約交易（支持做空）
- 雙向趨勢跟隨策略

> ⚠️ **注意**：此策略目前未加入 UI 介面，需手動在程式碼中使用。

---

## 策略選擇建議

| 市場狀態 | 推薦策略 |
|----------|----------|
| 強勢趨勢 | SMA Cross, LuciTech EMA |
| 區間震盪 | RSI Mean Reversion |
| 高波動 | SMA Cross + ATR 停損, LuciTech EMA |
| 低波動 | RSI Mean Reversion |

---

## 參數優化建議

1. **避免過度擬合**：使用不同時間段的數據進行樣本外測試
2. **考慮交易成本**：過短的週期參數會增加交易頻率
3. **風險報酬比**：建議至少 1.5:1 以上
4. **停損設定**：ATR 倍數建議 1.5-2.5 之間

---

## 6. FreedX Grid Backtest (網格交易回測)

> ⚠️ **狀態**：尚未實作 (Not Implemented) - 待開發中

### 策略原理

網格交易 (Grid Trading) 是一種在特定價格區間內自動進行「低買高賣」的策略。
- 策略會在預設的價格範圍內，畫出多條網格線 (Grid Levels)。
- 當價格下跌觸碰到網格線時買入，當價格上漲觸碰到上一格網格線時賣出（做多網格）。
- 此策略最適合**震盪行情 (Volatility)**，利用價格在區間內的來回波動獲利。

### 主要功能 (Features)

根據 FreedX 的原始設計，此策略包含以下進階功能：

1.  **回測範圍 (Backtest Range)**：
    - 精確設定回測的開始與結束時間，結束時自動平倉。

2.  **投資與複利 (Investment & Compounding)**：
    - **Fixed (固定)**：每次網格下單金額固定。
    - **Compound (複利)**：將獲利重新投入，隨時間增加每次的下單量。

3.  **網格分佈 (Distribution)**：
    - **Arithmetic (等差)**：每格之間的「價格差」固定 (例：每 $100 一格)。
    - **Geometric (等比)**：每格之間的「漲跌幅百分比」固定 (例：每 1% 一格)。

4.  **方向模式 (Mode)**：
    - **Long (做多)**：預期震盪向上，先買後賣。 (Backtesting.py 支援)
    - **Short (做空)**：預期震盪向下，先賣後買。 (Backtesting.py 支援)
    - **Neutral (中性)**：區間內高出低進，同時掛多空單。 (Backtesting.py 目前**不支援**鎖倉模式)

5.  **手動區間與止損 (Manual Levels & Stop Triggers)**：
    - 手動設定網格的**最高價 (Top)**、**最低價 (Bottom)** 與 **參考價 (Reference)**。
    - 設定 **Stop Triggers** (止損觸發價)，當價格突破區間過多時強制平倉以保護本金。

### 參數說明 (參考 Pine Script)

| 參數分類 | 參數名稱 | 說明 |
|----------|----------|------|
| **Investment** | `Investment` | 總投資金額 |
| | `Leverage` | 槓桿倍數 |
| | `Method` | Auto / Compound / Fixed (資金管理模式) |
| **Grid** | `Number Of Grids` | 網格數量 (格數) |
| | `Distribution` | Arithmetic / Geometric (分佈方式) |
| | `Mode` | Neutral / Long / Short (交易方向) |
| **Levels** | `Top Range` | 網格區間上限 |
| | `Bottom Range` | 網格區間下限 |
| **Stoppers** | `Stop Triggers` | 啟用止損觸發 |
| | `Upper/Lower Limit` | 止損/止盈的極限價格 |

### 優點

- ✅ **自動化獲利**：在震盪行情中無需人為盯盤，自動低買高賣。
- ✅ **克服人性**：嚴格執行紀律，不會因為貪婪或恐懼錯過買賣點。
- ✅ **資金利用率高**：可透過槓桿放大震盪收益。

### 缺點

- ❌ **單邊行情風險**：若價格突破網格區間後一去不回（大漲或大跌），會造成浮動虧損或踏空。
- ❌ **資金分散**：資金被分散到多個網格中，單筆獲利較小。
- ❌ **架構限制**：目前 Backtesting.py 無法完美模擬雙向鎖倉 (Hedging) 模式。

### 適用場景

- **震盪盤整 (Consolidation)**：價格在箱型區間內來回波動。
- 波動率較高的主流幣種 (如 BTC, ETH, SOL)。

---

## 7. Ehlers Combo (綜合策略)

### 策略來源

根據 TradingView 上 simwai 分享的 Pine Script v5 策略轉換。
結合了 John Ehlers 的多個經典指標，形成高精度的交易系統。

### 策略原理

結合 5 個 Ehlers 指標形成五重過濾的交易系統：

1. **Signal to Noise Ratio (SNR)**：信噪比，過濾雜訊
2. **Elegant Oscillator**：優雅震盪指標，捕捉動能
3. **Decycler**：解循環濾波器，過濾高頻雜訊
4. **Instantaneous Trendline**：瞬時趨勢線，判斷趨勢方向
5. **Spearman Rank**：斯皮爾曼等級相關，衡量趨勢強度

### 交易訊號

| 訊號 | 條件 | 動作 |
|------|------|------|
| 買入 | EO 向上穿越 0 + Decycler 向上 + 價格 > 上升趨勢線 + Spearman > 0 + SNR > 閾值 | 做多 |
| 賣空 | EO 向下穿越 0 + Decycler 向下 + 價格 < 下降趨勢線 + Spearman < 0 + SNR > 閾值 | 做空 |
| 平多 | 價格跌破瞬時趨勢線 | 平倉 |
| 平空 | 價格突破瞬時趨勢線 | 平倉 |

### 參數說明

| 參數 | 說明 | 預設值 | 建議範圍 |
|------|------|--------|----------|
| `length` | 主要週期 | 20 | 10-50 |
| `rms_length` | RMS 計算週期 | 50 | 20-100 |
| `snr_threshold` | SNR 閾值 | 0.1 | 0.05-0.5 |
| `exit_length` | 出場訊號回看週期 | 10 | 1-50 |

### 優點

- ✅ 五重過濾，訊號品質高
- ✅ SNR 有效過濾盤整雜訊
- ✅ 結合趨勢、動能、統計相關性
- ✅ 基於訊號處理理論，數學基礎穩固

### 缺點

- ❌ 交易次數可能較少
- ❌ 計算複雜，需要較多歷史數據
- ❌ 參數較多，需要根據市場調整

### 適用場景

- 趨勢明顯的市場
- 需要高勝率的交易系統
- 逯廣波動原理的量化交易
